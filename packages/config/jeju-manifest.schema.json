{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Jeju App Manifest",
  "description": "Configuration for Jeju Network applications",
  "type": "object",
  "required": ["name", "version"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Schema reference"
    },
    "name": {
      "type": "string",
      "description": "App identifier (lowercase, no spaces)"
    },
    "displayName": {
      "type": "string",
      "description": "Human-readable app name"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+",
      "description": "Semantic version"
    },
    "type": {
      "type": "string",
      "enum": ["core", "service", "utility", "vendor"],
      "description": "App category"
    },
    "description": {
      "type": "string",
      "description": "App description"
    },
    "commands": {
      "type": "object",
      "description": "Available commands",
      "properties": {
        "dev": { "type": "string" },
        "build": { "type": "string" },
        "start": { "type": "string" },
        "test": { "type": "string" }
      }
    },
    "ports": {
      "type": "object",
      "description": "Port assignments",
      "properties": {
        "main": { "type": "integer" },
        "api": { "type": "integer" },
        "ws": { "type": "integer" }
      }
    },
    "dependencies": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Required packages/apps"
    },
    "optional": {
      "type": "boolean",
      "default": false
    },
    "enabled": {
      "type": "boolean",
      "default": true
    },
    "autoStart": {
      "type": "boolean",
      "default": false,
      "description": "Auto-start with jeju dev"
    },
    "tags": {
      "type": "array",
      "items": { "type": "string" }
    },
    "healthCheck": {
      "type": "object",
      "properties": {
        "url": { "type": "string" },
        "interval": { "type": "integer" }
      }
    },
    "jns": {
      "type": "object",
      "description": "JNS registration info",
      "properties": {
        "name": { "type": "string" },
        "description": { "type": "string" },
        "url": { "type": "string" }
      }
    },
    "agent": {
      "type": "object",
      "description": "A2A/MCP agent configuration",
      "properties": {
        "enabled": { "type": "boolean" },
        "a2aEndpoint": { "type": "string" },
        "mcpEndpoint": { "type": "string" },
        "tags": { "type": "array", "items": { "type": "string" } },
        "metadata": { "type": "object" },
        "trustModels": { "type": "array", "items": { "type": "string" } },
        "x402Support": { "type": "boolean" },
        "jnsName": { "type": "string" }
      }
    },
    "testing": {
      "type": "object",
      "description": "Test configuration",
      "properties": {
        "unit": {
          "type": "object",
          "properties": {
            "command": { "type": "string" },
            "timeout": { "type": "integer", "default": 120000 }
          }
        },
        "integration": {
          "type": "object",
          "properties": {
            "command": { "type": "string" },
            "timeout": { "type": "integer", "default": 180000 },
            "requiresChain": { "type": "boolean", "default": true },
            "requiresServices": { "type": "boolean", "default": true }
          }
        },
        "e2e": {
          "type": "object",
          "properties": {
            "command": { "type": "string" },
            "config": { "type": "string" },
            "timeout": { "type": "integer", "default": 300000 },
            "requiresChain": { "type": "boolean", "default": true },
            "requiresWallet": { "type": "boolean", "default": false }
          }
        },
        "services": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Required services for testing"
        },
        "dependencies": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Other apps needed for testing"
        }
      }
    },
    "architecture": {
      "type": "object",
      "description": "Application architecture configuration",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["serverless", "container", "hybrid"],
          "description": "Deployment type: serverless (workerd), container (Docker), or hybrid"
        },
        "runtime": {
          "type": "string",
          "enum": ["workerd", "bun", "node", "docker"],
          "description": "Execution runtime"
        },
        "frontend": {
          "type": "object",
          "properties": {
            "type": { "type": "string", "enum": ["spa", "mpa", "ssr", "static"] },
            "builder": { "type": "string", "enum": ["vite", "bun", "webpack", "next"] },
            "entrypoint": { "type": "string" },
            "outputDir": { "type": "string" }
          }
        },
        "backend": {
          "type": "object",
          "properties": {
            "type": { "type": "string", "enum": ["elysia", "custom"] },
            "entrypoint": { "type": "string" },
            "outputDir": { "type": "string" }
          }
        }
      }
    },
    "dws": {
      "type": "object",
      "description": "DWS (Decentralized Web Services) worker configuration",
      "properties": {
        "worker": {
          "type": "object",
          "description": "Serverless worker configuration (workerd-based)",
          "properties": {
            "name": { "type": "string", "description": "Worker name" },
            "entrypoint": { "type": "string", "description": "Main worker file" },
            "compatibilityDate": { "type": "string", "description": "Workers API compatibility date" },
            "tee": {
              "type": "object",
              "description": "TEE (Trusted Execution Environment) configuration",
              "properties": {
                "required": { "type": "boolean" },
                "preferred": { "type": "boolean" },
                "platforms": { "type": "array", "items": { "type": "string", "enum": ["dstack", "phala", "intel_sgx", "intel_tdx", "amd_sev"] } }
              }
            },
            "bindings": {
              "type": "object",
              "description": "Worker bindings (KV, D1, secrets)",
              "properties": {
                "kv": { "type": "object", "additionalProperties": { "type": "string" } },
                "d1": { "type": "object", "additionalProperties": { "type": "string" } },
                "secrets": { "type": "array", "items": { "type": "string" } }
              }
            },
            "routes": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "pattern": { "type": "string" },
                  "zone": { "type": "string" }
                }
              }
            }
          }
        },
        "scaling": {
          "type": "object",
          "description": "Autoscaling configuration with scale-to-zero support",
          "properties": {
            "minInstances": { "type": "integer", "minimum": 0, "default": 0, "description": "Minimum instances (0 for scale-to-zero)" },
            "maxInstances": { "type": "integer", "minimum": 1, "default": 100 },
            "targetConcurrency": { "type": "integer", "minimum": 1, "default": 10 },
            "scaleToZero": { "type": "boolean", "default": true },
            "idleTimeoutMs": { "type": "integer", "default": 600000, "description": "Idle timeout before scaling to zero (ms)" },
            "cooldownMs": { "type": "integer", "default": 60000 },
            "regions": {
              "type": "array",
              "description": "Regional scaling overrides",
              "items": {
                "type": "object",
                "properties": {
                  "region": { "type": "string" },
                  "enabled": { "type": "boolean" },
                  "minInstances": { "type": "integer" },
                  "maxInstances": { "type": "integer" },
                  "scaleToZero": { "type": "boolean" },
                  "idleTimeoutMs": { "type": "integer" }
                }
              }
            },
            "preferredRegions": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Preferred regions for traffic routing"
            },
            "geoRouting": { "type": "boolean", "default": true }
          }
        },
        "database": {
          "type": "object",
          "description": "CovenantSQL database configuration",
          "properties": {
            "type": { "type": "string", "enum": ["covenantsql", "d1", "none"] },
            "name": { "type": "string" },
            "consistency": { "type": "string", "enum": ["strong", "eventual"] },
            "tables": { "type": "array", "items": { "type": "string" } }
          }
        },
        "cdn": {
          "type": "object",
          "description": "CDN configuration for static assets",
          "properties": {
            "enabled": { "type": "boolean" },
            "regions": { "type": "array", "items": { "type": "string" } },
            "staticDir": { "type": "string" },
            "cacheRules": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "pattern": { "type": "string" },
                  "ttl": { "type": "integer" },
                  "immutable": { "type": "boolean" },
                  "staleWhileRevalidate": { "type": "integer" }
                }
              }
            }
          }
        }
      }
    },
    "decentralization": {
      "type": "object",
      "description": "Decentralized infrastructure configuration",
      "properties": {
        "database": {
          "type": "object",
          "description": "CovenantQL database configuration",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["covenantql", "cql-sync", "none"],
              "description": "Database mode: covenantql (direct), cql-sync (replicated from Postgres), none"
            },
            "databaseId": {
              "type": "string",
              "description": "Unique database identifier"
            },
            "consistency": {
              "type": "string",
              "enum": ["strong", "eventual", "causal"],
              "description": "Consistency level for reads"
            },
            "replication": {
              "type": "number",
              "minimum": 1,
              "maximum": 5,
              "description": "Replication factor for data"
            }
          },
          "required": ["type"]
        },
        "cache": {
          "type": "object",
          "description": "Decentralized cache configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Whether to use decentralized cache"
            },
            "namespace": {
              "type": "string",
              "description": "Cache namespace for this app"
            },
            "planId": {
              "type": "string",
              "enum": ["basic", "standard", "premium"],
              "description": "Cache plan tier"
            },
            "ttl": {
              "type": "number",
              "description": "Default TTL in seconds"
            }
          }
        },
        "cdn": {
          "type": "object",
          "description": "CDN and edge caching configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Whether to use CDN for this app"
            },
            "regions": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Preferred CDN regions for edge caching"
            },
            "cacheRules": {
              "type": "array",
              "description": "Custom cache rules by path pattern",
              "items": {
                "type": "object",
                "properties": {
                  "pattern": { "type": "string", "description": "URL pattern (glob)" },
                  "ttl": { "type": "number", "description": "TTL in seconds" },
                  "staleWhileRevalidate": { "type": "number", "description": "SWR window in seconds" },
                  "immutable": { "type": "boolean", "description": "Content-addressed immutable content" }
                }
              }
            },
            "apiCaching": {
              "type": "object",
              "description": "API response caching configuration",
              "properties": {
                "enabled": { "type": "boolean" },
                "defaultTtl": { "type": "number" },
                "varyHeaders": { "type": "array", "items": { "type": "string" } }
              }
            },
            "serviceWorker": {
              "type": "boolean",
              "description": "Enable service worker for offline support"
            }
          }
        },
        "secrets": {
          "type": "object",
          "description": "Vault-backed secrets configuration",
          "properties": {
            "required": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Required secrets (app fails to start without these)"
            },
            "optional": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Optional secrets (app can start without these)"
            }
          }
        },
        "triggers": {
          "type": "array",
          "description": "Cron, webhook, and event triggers",
          "items": {
            "type": "object",
            "required": ["name", "type", "endpoint"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Unique trigger identifier"
              },
              "type": {
                "type": "string",
                "enum": ["cron", "webhook", "event"],
                "description": "Trigger type"
              },
              "cronExpression": {
                "type": "string",
                "description": "Cron expression (for cron triggers)"
              },
              "webhookPath": {
                "type": "string",
                "description": "Webhook path (for webhook triggers)"
              },
              "eventTypes": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Event types to listen for (for event triggers)"
              },
              "endpoint": {
                "type": "string",
                "description": "Endpoint to call when trigger fires"
              },
              "description": {
                "type": "string",
                "description": "Human-readable description"
              },
              "timeout": {
                "type": "number",
                "description": "Execution timeout in milliseconds"
              },
              "retries": {
                "type": "number",
                "minimum": 0,
                "maximum": 5,
                "description": "Number of retry attempts on failure"
              }
            }
          }
        },
        "frontend": {
          "type": "object",
          "description": "Frontend deployment to IPFS + JNS + CDN",
          "properties": {
            "ipfs": {
              "type": "boolean",
              "description": "Whether to deploy frontend to IPFS"
            },
            "arweave": {
              "type": "boolean",
              "description": "Whether to deploy frontend to Arweave for permanent storage"
            },
            "jnsName": {
              "type": "string",
              "description": "JNS name for frontend resolution (e.g., app.jeju)"
            },
            "buildDir": {
              "type": "string",
              "description": "Build output directory (default: dist, build, out)"
            },
            "spa": {
              "type": "boolean",
              "description": "Whether this is a single-page application"
            },
            "fallbackOrigins": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Fallback HTTP origins if IPFS/Arweave unavailable"
            }
          }
        },
        "robustness": {
          "type": "object",
          "description": "Robustness and resilience configuration",
          "properties": {
            "multiOrigin": {
              "type": "boolean",
              "description": "Content stored on multiple origins (IPFS + Arweave + HTTP)"
            },
            "offlineSupport": {
              "type": "boolean",
              "description": "App works offline via service worker"
            },
            "p2pFallback": {
              "type": "boolean",
              "description": "Use P2P network as fallback when CDN unavailable"
            },
            "contentAddressed": {
              "type": "boolean",
              "description": "All assets use content-addressed URLs for integrity"
            }
          }
        }
      }
    }
  }
}
