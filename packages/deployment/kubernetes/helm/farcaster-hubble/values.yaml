# =============================================================================
# Farcaster Hubble - Permissionless Hub Node
# 
# Runs a self-hosted Farcaster hub, removing dependency on Neynar API.
# No API keys required - fully permissionless.
#
# @see https://www.thehubble.xyz/
# =============================================================================

replicaCount: 1

image:
  repository: farcasterxyz/hubble
  pullPolicy: IfNotPresent
  tag: "1.14.0"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: "farcaster-hubble"

# Hub identity (generated on first run if not provided)
identity:
  # Use existing secret for hub identity
  existingSecret: ""
  # Or generate new identity
  generate: true

# Ethereum RPC for FID verification (OP Mainnet)
ethereum:
  # Optimism mainnet RPC (where Farcaster contracts live)
  rpcUrl: "https://mainnet.optimism.io"
  # Use your own RPC for better reliability
  # rpcUrl: "https://optimism-mainnet.infura.io/v3/YOUR_KEY"

# Hub network configuration
network:
  # Hub will sync from these bootstrap peers
  bootstrapPeers:
    - "/dns/nemes.farcaster.xyz/tcp/2282"
    - "/dns/hoyt.farcaster.xyz/tcp/2282"
  
  # gRPC port for hub API
  grpcPort: 2283
  
  # Gossip port for peer communication
  gossipPort: 2282
  
  # HTTP API port (optional)
  httpPort: 2281
  
  # Enable HTTP API
  httpApiEnabled: true

# Database configuration
database:
  # RocksDB storage path
  path: /data/rocks
  
  # Enable pruning (recommended for non-archive nodes)
  pruneMessages: true
  
  # Prune messages older than N days
  pruneMessagesDays: 365

# Sync configuration
sync:
  # Sync all FIDs (hub mode) vs specific FIDs (client mode)
  fullSync: true
  
  # Specific FIDs to sync (if not full sync)
  fids: []

# Resource management
resources:
  limits:
    cpu: 4000m
    memory: 8Gi
  requests:
    cpu: 2000m
    memory: 4Gi

# Persistence for hub data
persistence:
  enabled: true
  storageClass: ""
  accessMode: ReadWriteOnce
  size: 500Gi  # Farcaster data grows ~1GB/day

# Service configuration
service:
  type: ClusterIP
  
  grpc:
    port: 2283
    protocol: TCP
  
  gossip:
    port: 2282
    protocol: TCP
  
  http:
    port: 2281
    protocol: TCP

# Ingress for external hub API access
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
    nginx.ingress.kubernetes.io/backend-protocol: "GRPC"
  hosts:
    - host: hub.testnet.jejunetwork.org
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: hub-tls
      hosts:
        - hub.testnet.jejunetwork.org

# Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod configuration
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "2281"
  prometheus.io/path: "/metrics"

podSecurityContext:
  fsGroup: 1000

securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
      - ALL

# Probes
livenessProbe:
  httpGet:
    path: /v1/info
    port: http
  initialDelaySeconds: 60
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 5

readinessProbe:
  httpGet:
    path: /v1/info
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# Node scheduling
nodeSelector:
  workload: indexer

tolerations: []

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - farcaster-hubble
          topologyKey: kubernetes.io/hostname

# Monitoring
monitoring:
  enabled: true
  serviceMonitor:
    enabled: true
    interval: 30s
    scrapeTimeout: 10s
    labels:
      release: prometheus

# Environment-specific overrides
# values-testnet.yaml will override these
environment: testnet

# =============================================================================
# Revenue & Integration Configuration
# =============================================================================

# Jeju integration
jeju:
  # Enable Jeju indexer integration
  indexerEnabled: true
  indexerUrl: "http://indexer.jeju.svc.cluster.local:4350/graphql"
  
  # Sync Farcaster profiles to Jeju identity registry
  syncIdentities: true
  
  # GraphQL endpoint for external queries
  graphqlEnabled: true

