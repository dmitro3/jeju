# Testnet-specific values for DWS

replicaCount: 3

image:
  repository: 502713364895.dkr.ecr.us-east-1.amazonaws.com/jeju/dws
  tag: "testnet-latest"

ingress:
  enabled: true
  className: "alb"
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/ssl-redirect: "443"
    # ACM certificate ARN - set via Helmfile or terraform output
    alb.ingress.kubernetes.io/certificate-arn: "arn:aws:acm:us-east-1:502713364895:certificate/414c8f7b-6ebf-470b-86c4-fc5d1722b8b7"
    alb.ingress.kubernetes.io/group.name: jeju-testnet
  hosts:
    # Core DWS services
    - host: dws.testnet.jejunetwork.org
      paths:
        - path: /
          pathType: Prefix
    - host: storage.testnet.jejunetwork.org
      paths:
        - path: /
          pathType: Prefix
    # Git hosting
    - host: git.testnet.jejunetwork.org
      paths:
        - path: /
          pathType: Prefix
    # Package registries
    - host: npm.testnet.jejunetwork.org
      paths:
        - path: /
          pathType: Prefix
    - host: hub.testnet.jejunetwork.org
      paths:
        - path: /
          pathType: Prefix
    - host: registry.testnet.jejunetwork.org
      paths:
        - path: /
          pathType: Prefix
    # JNS Gateway (serves decentralized apps)
    - host: jns.testnet.jejunetwork.org
      paths:
        - path: /
          pathType: Prefix
    # App routing - individual apps routed through DWS
    # DWS app router handles frontend (IPFS) + backend (workers) routing
    - host: oauth3.testnet.jejunetwork.org
      paths:
        - path: /
          pathType: Prefix
    - host: autocrat.testnet.jejunetwork.org
      paths:
        - path: /
          pathType: Prefix
    - host: bazaar.testnet.jejunetwork.org
      paths:
        - path: /
          pathType: Prefix
    - host: crucible.testnet.jejunetwork.org
      paths:
        - path: /
          pathType: Prefix
    - host: factory.testnet.jejunetwork.org
      paths:
        - path: /
          pathType: Prefix
    - host: gateway.testnet.jejunetwork.org
      paths:
        - path: /
          pathType: Prefix

resources:
  limits:
    cpu: 2000m
    memory: 4Gi
  requests:
    cpu: 500m
    memory: 1Gi

config:
  network: testnet
  chainId: 420690
  rpcUrl: "https://testnet-rpc.jejunetwork.org"
  
  # Contract addresses - populated after deployment
  contracts:
    identityRegistry: "${IDENTITY_REGISTRY_ADDRESS}"
    repoRegistry: "${REPO_REGISTRY_ADDRESS}"
    packageRegistry: "${PACKAGE_REGISTRY_ADDRESS}"
    containerRegistry: "${CONTAINER_REGISTRY_ADDRESS}"
    modelRegistry: "${MODEL_REGISTRY_ADDRESS}"
    jnsRegistry: "${JNS_REGISTRY_ADDRESS}"
    jnsResolver: "${JNS_RESOLVER_ADDRESS}"
    storageManager: "${STORAGE_MANAGER_ADDRESS}"
  
  storage:
    primary: ipfs
    permanent: true
    backends:
      - type: ipfs
        enabled: true
        gateway: "https://ipfs.io"
        pinningService: "internal"
      - type: arweave
        enabled: true
        gateway: "https://arweave.net"
      - type: webtorrent
        enabled: true
  
  # JNS Gateway - serves apps at jns.testnet.jejunetwork.org
  jnsGateway:
    enabled: true
    domain: "jns.testnet.jejunetwork.org"
    defaultTtl: 300
    cacheEnabled: true
    fallbackToIpfs: true
  
  # App Router - handles *.testnet.jejunetwork.org routing
  # Routes frontend to IPFS and backend to DWS workers
  appRouter:
    enabled: true
    domain: "testnet.jejunetwork.org"
    wildcardDomain: "*.testnet.jejunetwork.org"
    # System subdomains that should NOT be routed as apps
    systemSubdomains:
      - dws
      - api
      - rpc
      - ws
      - explorer
      - bridge
      - faucet
      - docs
      - storage
      - git
      - npm
      - hub
      - registry
      - jns
    # Default API paths to route to backend
    defaultApiPaths:
      - /api
      - /health
      - /a2a
      - /mcp
      - /oauth
      - /callback
      - /webhook
  
  cdn:
    enabled: true
    edgeNodes: 3
    regions:
      - us-east-1
      - eu-west-1
      - ap-northeast-1
  
  p2p:
    enabled: true
    bootstrapPeers:
      - "/dns4/dws-0.testnet.jejunetwork.org/tcp/4031"
      - "/dns4/dws-1.testnet.jejunetwork.org/tcp/4031"
      - "/dns4/dws-2.testnet.jejunetwork.org/tcp/4031"

env:
  - name: NODE_ENV
    value: "development"  # Use development for testnet to bypass strict production security checks
  # Enable P2P for decentralized node discovery
  - name: DWS_P2P_ENABLED
    value: "true"
  # Enable provider mode - this node participates in the provider network
  - name: DWS_PROVIDER_ENABLED
    value: "true"
  - name: DWS_PORT
    value: "4030"
  - name: LOG_LEVEL
    value: "info"
  - name: NETWORK
    value: "testnet"
  - name: DWS_P2P_ENABLED
    value: "true"
  - name: DWS_BASE_URL
    value: "https://dws.testnet.jejunetwork.org"
  - name: JNS_GATEWAY_ENABLED
    value: "true"
  - name: JNS_GATEWAY_DOMAIN
    value: "jns.testnet.jejunetwork.org"
  # SQLit connection for decentralized database
  - name: SQLIT_ENABLED
    value: "true"
  - name: SQLIT_HTTP_URL
    value: "http://sqlit.dws.svc.cluster.local:8546"
  - name: SQLIT_CLUSTER_URL
    value: "sqlit.dws.svc.cluster.local:4661"

persistence:
  # Disabled - DWS uses SQLit + ConfigMap for state (allows HA with 3 replicas)
  enabled: false
  storageClass: "gp3"
  size: 100Gi

autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70

metrics:
  enabled: true
  serviceMonitor:
    enabled: true
