# CovenantSQL Helm Chart Values
# Default configuration for testnet deployment

# Global settings
global:
  network: testnet
  chainId: 84532  # Base Sepolia
  imageRegistry: ghcr.io/jeju-network

# Image configuration
image:
  repository: ghcr.io/jeju-network/covenantsql
  pullPolicy: IfNotPresent
  tag: "latest"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# ============================================================================
# Block Producer Configuration
# ============================================================================
blockProducer:
  enabled: true
  replicaCount: 1  # Only 1 BP per cluster (leader election via Kayak)

  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi

  persistence:
    enabled: true
    storageClass: ""
    size: 50Gi
    accessModes:
      - ReadWriteOnce

  config:
    blockInterval: 3s
    maxBlockSize: 2097152
    heartbeatInterval: 1s
    electionTimeout: 5s

  service:
    type: ClusterIP
    clientPort: 4661
    rpcPort: 4662
    kayakPort: 4663
    httpPort: 8546
    metricsPort: 9100

  nodeSelector: {}
  tolerations: []
  affinity: {}

# ============================================================================
# Miner Configuration
# ============================================================================
miner:
  enabled: true
  replicaCount: 3  # Minimum 3 for consensus

  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 512Mi

  persistence:
    enabled: true
    storageClass: ""
    size: 100Gi
    accessModes:
      - ReadWriteOnce

  config:
    replicationFactor: 2
    syncInterval: 5s
    vectorSearchEnabled: true

  service:
    type: ClusterIP
    clientPort: 4661
    httpPort: 8546
    metricsPort: 9100

  # Pod Anti-Affinity to spread miners across nodes
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchLabels:
              app.kubernetes.io/component: miner
          topologyKey: kubernetes.io/hostname

  nodeSelector: {}
  tolerations: []

# ============================================================================
# Load Balancer (Internal)
# ============================================================================
loadBalancer:
  enabled: true
  type: ClusterIP  # Use Ingress for external access

  # Annotations for cloud provider load balancers
  annotations: {}

# ============================================================================
# Ingress Configuration
# ============================================================================
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: cql.testnet.jejunetwork.org
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: cql-tls
      hosts:
        - cql.testnet.jejunetwork.org

# ============================================================================
# Service Account
# ============================================================================
serviceAccount:
  create: true
  annotations: {}
  name: ""

# ============================================================================
# Contract Addresses (unified contracts from main deployment)
# ============================================================================
# CQL uses ComputeRegistry with serviceType=keccak256("database")
# instead of separate CQL-specific contracts
contracts:
  computeRegistry: ""   # ComputeRegistry - register as database provider
  serviceRegistry: ""   # ServiceRegistry - for pricing and usage
  creditManager: ""     # CreditManager - for billing/credits

# ============================================================================
# RPC Configuration
# ============================================================================
rpc:
  primary: "https://sepolia.base.org"
  fallback: ""

# ============================================================================
# Operator Configuration
# ============================================================================
operator:
  # Private key for operator transactions (from secret)
  privateKeySecret: cql-operator-key
  privateKeyKey: private-key

  # Heartbeat interval
  heartbeatIntervalMs: 60000

  # Auto-register with on-chain registry
  autoRegister: true

# ============================================================================
# Monitoring
# ============================================================================
metrics:
  enabled: true
  port: 9100
  path: /metrics

serviceMonitor:
  enabled: false
  namespace: ""
  interval: 30s
  scrapeTimeout: 10s

# ============================================================================
# Pod Disruption Budget
# ============================================================================
podDisruptionBudget:
  enabled: true
  minAvailable: 2  # At least 2 miners must be available

# ============================================================================
# Network Policies
# ============================================================================
networkPolicy:
  enabled: true
  # Allow ingress from same namespace and monitoring
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: monitoring
        - podSelector: {}
