apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "crucible.fullname" . }}-config
  labels:
    {{- include "crucible.labels" . | nindent 4 }}
data:
  NETWORK: {{ .Values.config.network | quote }}
  RPC_URL: {{ .Values.config.rpcUrl | quote }}
  AGENT_VAULT_ADDRESS: {{ .Values.config.contracts.agentVault | quote }}
  ROOM_REGISTRY_ADDRESS: {{ .Values.config.contracts.roomRegistry | quote }}
  TRIGGER_REGISTRY_ADDRESS: {{ .Values.config.contracts.triggerRegistry | quote }}
  IDENTITY_REGISTRY_ADDRESS: {{ .Values.config.contracts.identityRegistry | quote }}
  SERVICE_REGISTRY_ADDRESS: {{ .Values.config.contracts.serviceRegistry | quote }}
  AUTOCRAT_TREASURY_ADDRESS: {{ .Values.config.contracts.autocratTreasury | quote }}
  COMPUTE_MARKETPLACE_URL: {{ .Values.config.services.computeMarketplace | quote }}
  STORAGE_API_URL: {{ .Values.config.services.storageApi | quote }}
  IPFS_GATEWAY: {{ .Values.config.services.ipfsGateway | quote }}
  INDEXER_GRAPHQL_URL: {{ .Values.config.services.indexerGraphql | quote }}
  DEX_CACHE_URL: {{ .Values.config.services.dexCacheUrl | quote }}
  LOG_LEVEL: {{ .Values.config.logLevel | default "info" | quote }}
  LOG_FORMAT: {{ .Values.config.logFormat | default "json" | quote }}
  {{- if .Values.bot.enabled }}
  # Bot Configuration
  BOT_MIN_PROFIT_BPS: {{ .Values.bot.minProfitBps | default 50 | quote }}
  BOT_MAX_SLIPPAGE_BPS: {{ .Values.bot.maxSlippageBps | default 100 | quote }}
  {{- if .Values.bot.solanaRpcUrl }}
  SOLANA_RPC_URL: {{ .Values.bot.solanaRpcUrl | quote }}
  {{- end }}
  {{- if .Values.bot.solanaNetwork }}
  SOLANA_NETWORK: {{ .Values.bot.solanaNetwork | quote }}
  {{- end }}
  # Yield Farming Configuration
  {{- if .Values.bot.enableYieldFarming }}
  ENABLE_YIELD_FARMING: "true"
  {{- with .Values.bot.yieldFarming }}
  YIELD_MIN_APR: {{ .minApr | default 1 | quote }}
  YIELD_MAX_RISK_SCORE: {{ .maxRiskScore | default 60 | quote }}
  YIELD_PREFER_REAL_YIELD: {{ .preferRealYield | default true | quote }}
  YIELD_MIN_TVL: {{ .minTvl | default 1000000 | quote }}
  YIELD_MAX_POSITION_PERCENT: {{ .maxPositionPercent | default 20 | quote }}
  YIELD_AUTO_COMPOUND: {{ .autoCompound | default true | quote }}
  YIELD_AUTO_REBALANCE: {{ .autoRebalance | default true | quote }}
  {{- end }}
  {{- end }}
  {{- end }}
