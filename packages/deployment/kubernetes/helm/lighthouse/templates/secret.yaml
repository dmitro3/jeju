{{- if and .Values.config.execution.jwtSecret (not .Values.secrets.existingJwtSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "lighthouse.fullname" . }}-secrets
  labels:
    {{- include "lighthouse.labels" . | nindent 4 }}
  annotations:
    # This secret should be managed by External Secrets Operator or Vault in production
    vault.hashicorp.com/agent-inject: "true"
    vault.hashicorp.com/role: "lighthouse"
    vault.hashicorp.com/agent-inject-secret-jwt: "secret/data/jeju/{{ .Release.Namespace }}/jwt"
type: Opaque
data:
  # WARNING: In production, use Vault, External Secrets, or generate at deploy time
  # Never commit real JWT secrets to version control
  jwt.hex: {{ .Values.config.execution.jwtSecret | b64enc | quote }}
{{- end }}

