{
  "$schema": "../../packages/config/jeju-manifest.schema.json",
  "name": "bazaar",
  "displayName": "Bazaar",
  "version": "2.0.0",
  "type": "core",
  "description": "Unified DeFi + NFT + Token Launchpad - Decentralized marketplace with Elysia backend and static frontend",
  "architecture": {
    "type": "hybrid",
    "runtime": "workerd",
    "frontend": {
      "type": "spa",
      "builder": "bun",
      "entrypoint": "index.html",
      "outputDir": "dist/static"
    },
    "backend": {
      "type": "elysia",
      "entrypoint": "api/worker.ts",
      "outputDir": "dist/worker"
    }
  },
  "commands": {
    "dev": "bun run dev",
    "dev:api": "bun --watch api/server.ts",
    "build": "bun run scripts/build.ts",
    "build:worker": "bun run scripts/build-worker.ts",
    "start": "bun run scripts/serve.ts",
    "test": "bun run test:unit",
    "deploy": "bun run scripts/deploy.ts"
  },
  "ports": {
    "main": 4006,
    "frontend": 4006,
    "api": 4007
  },
  "dependencies": ["contracts", "config", "dws", "shared"],
  "optional": false,
  "enabled": true,
  "autoStart": true,
  "tags": ["defi", "nft", "marketplace", "uniswap-v4", "launchpad", "multi-chain", "jns", "core", "serverless"],
  "jns": {
    "name": "bazaar.jeju",
    "description": "DeFi + NFT + Names Marketplace",
    "url": "https://bazaar.jejunetwork.org"
  },
  "healthCheck": {
    "frontend": {
      "url": "http://localhost:4006",
      "interval": 30000
    },
    "api": {
      "url": "http://localhost:4007/health",
      "interval": 30000
    }
  },
  "agent": {
    "enabled": true,
    "a2aEndpoint": "/api/a2a",
    "mcpEndpoint": "/api/mcp",
    "tags": ["jeju-app", "defi", "nft", "marketplace", "launchpad", "jns"],
    "metadata": {
      "category": "defi",
      "provider": "jeju-network",
      "features": ["swap", "liquidity", "nft-trading", "token-launch", "jns-names"]
    },
    "trustModels": ["open"],
    "x402Support": true,
    "jnsName": "bazaar.jeju"
  },
  "dws": {
    "worker": {
      "name": "bazaar-api",
      "entrypoint": "api/worker.ts",
      "compatibilityDate": "2025-06-01",
      "tee": {
        "required": false,
        "preferred": true,
        "platforms": ["dstack", "phala"]
      },
      "bindings": {
        "kv": {
          "BAZAAR_CACHE": "bazaar-cache-kv"
        },
        "secrets": ["DATABASE_URL", "PRIVATE_KEY"]
      },
      "routes": [
        { "pattern": "/api/*", "zone": "bazaar-api" },
        { "pattern": "/health", "zone": "bazaar-api" }
      ]
    },
    "database": {
      "type": "covenantsql",
      "name": "bazaar-db",
      "consistency": "strong",
      "tables": ["market_cache", "user_preferences"]
    },
    "cdn": {
      "enabled": true,
      "regions": ["global"],
      "staticDir": "dist/static",
      "cacheRules": [
        { "pattern": "/assets/**", "ttl": 31536000, "immutable": true },
        { "pattern": "/*.js", "ttl": 86400 },
        { "pattern": "/*.css", "ttl": 86400 },
        { "pattern": "/**/*.html", "ttl": 60, "staleWhileRevalidate": 3600 }
      ]
    }
  },
  "decentralization": {
    "worker": {
      "name": "bazaar-api",
      "entrypoint": "api/worker.ts",
      "runtime": "workerd",
      "memory": 256,
      "timeout": 60000,
      "compatibilityDate": "2025-06-01",
      "bindings": {
        "BAZAAR_CACHE": { "type": "kv", "name": "bazaar-cache-kv" }
      },
      "secrets": ["DATABASE_URL", "PRIVATE_KEY", "RPC_URL"],
      "routes": [
        { "pattern": "/api/*" },
        { "pattern": "/health" }
      ],
      "tee": {
        "required": false,
        "preferred": true,
        "platforms": ["dstack", "phala"]
      }
    },
    "frontend": {
      "buildDir": "dist/static",
      "buildCommand": "bun run build",
      "spa": true,
      "jnsName": "bazaar.jeju",
      "ipfs": true,
      "arweave": true,
      "cacheRules": [
        { "pattern": "/assets/**", "ttl": 31536000, "immutable": true },
        { "pattern": "/*.js", "ttl": 86400 },
        { "pattern": "/*.css", "ttl": 86400 },
        { "pattern": "/**/*.html", "ttl": 60, "staleWhileRevalidate": 3600 }
      ]
    },
    "robustness": {
      "multiOrigin": true,
      "offlineSupport": true,
      "p2pFallback": true,
      "contentAddressed": true
    }
  },
  "testing": {
    "unit": {
      "command": "bun test tests/",
      "timeout": 120000
    },
    "e2e": {
      "command": "bunx playwright test tests/e2e/",
      "timeout": 300000,
      "requiresChain": true
    },
    "services": ["contracts", "indexer", "dws"]
  }
}
