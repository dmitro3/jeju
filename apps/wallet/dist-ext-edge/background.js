import{_ as o}from"./chunks/preload-helper-BlTxHScW.js";let d=null;function m(){if(typeof navigator>"u")return"unknown";const t=navigator.userAgent.toLowerCase(),e=navigator.vendor?.toLowerCase()??"";return navigator.brave?.isBrave?"brave":t.includes("edg/")||t.includes("edge/")?"edge":t.includes("opr/")||t.includes("opera")?"opera":t.includes("firefox")?"firefox":t.includes("safari")&&!t.includes("chrome")&&e.includes("apple")?"safari":t.includes("chrome")&&e.includes("google")?"chrome":"unknown"}function _(){if(typeof window>"u")return"web";if("__TAURI__"in window){const e=navigator.userAgent.toLowerCase();return e.includes("mac")?"tauri-macos":e.includes("win")?"tauri-windows":"tauri-linux"}if("Capacitor"in window){const r=window.Capacitor?.getPlatform?.();if(r==="ios")return"capacitor-ios";if(r==="android")return"capacitor-android"}const t=m();return typeof safari<"u"&&safari.extension?.dispatchMessage?"safari-extension":typeof browser<"u"&&browser.runtime?.id?"firefox-extension":typeof chrome<"u"&&chrome.runtime?.id?t==="brave"?"brave-extension":t==="edge"?"edge-extension":"chrome-extension":"web"}function p(t){return t.startsWith("tauri-")?"desktop":t.startsWith("capacitor-")?"mobile":t.endsWith("-extension")?"extension":"web"}function S(t){const e=p(t),r={hasSecureStorage:!1,hasBiometrics:!1,hasDeepLinks:!1,hasIAP:!1,hasNotifications:!0,hasClipboard:!0,hasCamera:!1,hasShare:!0,maxStorageSize:10*1024*1024,supportsBackgroundTasks:!1};switch(e){case"desktop":return{...r,hasSecureStorage:!0,hasBiometrics:t==="tauri-macos",hasDeepLinks:!0,maxStorageSize:"unlimited",supportsBackgroundTasks:!0};case"mobile":return{...r,hasSecureStorage:!0,hasBiometrics:!0,hasDeepLinks:!0,hasIAP:!0,hasCamera:!0,maxStorageSize:"unlimited",supportsBackgroundTasks:t==="capacitor-ios"};case"extension":return{...r,hasSecureStorage:!0,hasDeepLinks:!1,maxStorageSize:"unlimited",supportsBackgroundTasks:!0};default:return{...r,hasSecureStorage:!1,hasDeepLinks:!0}}}function v(){if(d)return d;const t=_(),e=p(t),r=S(t);return d={type:t,category:e,version:"0.1.0",capabilities:r,osVersion:typeof navigator<"u"?navigator.userAgent:void 0},d}class k{prefix="jeju_wallet_";async get(e){return localStorage.getItem(this.prefix+e)}async set(e,r){localStorage.setItem(this.prefix+e,r)}async remove(e){localStorage.removeItem(this.prefix+e)}async clear(){const e=await this.keys();for(const r of e)await this.remove(r)}async keys(){const e=[];for(let r=0;r<localStorage.length;r++){const n=localStorage.key(r);n?.startsWith(this.prefix)&&e.push(n.slice(this.prefix.length))}return e}}class I{getStorage(){return typeof chrome<"u"?chrome.storage?.local:null}async get(e){const r=this.getStorage();return r?new Promise(n=>{r.get(e,s=>{n(s[e]??null)})}):null}async set(e,r){const n=this.getStorage();if(n)return new Promise(s=>{n.set({[e]:r},s)})}async remove(e){const r=this.getStorage();if(r)return new Promise(n=>{r.remove(e,n)})}async clear(){const e=this.getStorage();if(e)return new Promise(r=>{e.clear(r)})}async keys(){const e=this.getStorage();return e?new Promise(r=>{e.get(null,n=>{r(Object.keys(n))})}):[]}}class P{prefix="jeju_tauri_";async get(e){if(typeof window<"u"&&"__TAURI__"in window)try{const{invoke:r}=await o(async()=>{const{invoke:n}=await import("@tauri-apps/api/core");return{invoke:n}},[]);return r("storage_get",{key:e})}catch{}return localStorage.getItem(this.prefix+e)}async set(e,r){if(typeof window<"u"&&"__TAURI__"in window)try{const{invoke:n}=await o(async()=>{const{invoke:s}=await import("@tauri-apps/api/core");return{invoke:s}},[]);await n("storage_set",{key:e,value:r});return}catch{}localStorage.setItem(this.prefix+e,r)}async remove(e){if(typeof window<"u"&&"__TAURI__"in window)try{const{invoke:r}=await o(async()=>{const{invoke:n}=await import("@tauri-apps/api/core");return{invoke:n}},[]);await r("storage_remove",{key:e});return}catch{}localStorage.removeItem(this.prefix+e)}async clear(){const e=await this.keys();for(const r of e)await this.remove(r)}async keys(){if(typeof window<"u"&&"__TAURI__"in window)try{const{invoke:r}=await o(async()=>{const{invoke:n}=await import("@tauri-apps/api/core");return{invoke:n}},[]);return r("storage_keys")}catch{}const e=[];for(let r=0;r<localStorage.length;r++){const n=localStorage.key(r);n?.startsWith(this.prefix)&&e.push(n.slice(this.prefix.length))}return e}}class x{async get(e){try{const{Preferences:r}=await o(async()=>{const{Preferences:s}=await import("@capacitor/preferences");return{Preferences:s}},[]),{value:n}=await r.get({key:e});return n}catch{return null}}async set(e,r){try{const{Preferences:n}=await o(async()=>{const{Preferences:s}=await import("@capacitor/preferences");return{Preferences:s}},[]);await n.set({key:e,value:r})}catch(n){console.error("Failed to set storage:",n)}}async remove(e){try{const{Preferences:r}=await o(async()=>{const{Preferences:n}=await import("@capacitor/preferences");return{Preferences:n}},[]);await r.remove({key:e})}catch(r){console.error("Failed to remove from storage:",r)}}async clear(){try{const{Preferences:e}=await o(async()=>{const{Preferences:r}=await import("@capacitor/preferences");return{Preferences:r}},[]);await e.clear()}catch(e){console.error("Failed to clear storage:",e)}}async keys(){try{const{Preferences:e}=await o(async()=>{const{Preferences:n}=await import("@capacitor/preferences");return{Preferences:n}},[]),{keys:r}=await e.keys();return r}catch{return[]}}}let i=null;function c(){if(i)return i;switch(v().category){case"extension":i=new I;break;case"desktop":i=new P;break;case"mobile":i=new x;break;default:i=new k}return i}const g={get:t=>c().get(t),set:(t,e)=>c().set(t,e),remove:t=>c().remove(t),clear:()=>c().clear(),keys:()=>c().keys(),async getJSON(t){const e=await c().get(t);return e?JSON.parse(e):null},async setJSON(t,e){await c().set(t,JSON.stringify(e))}},y={isLocked:!0,accounts:[],chainId:"0x2105",connectedSites:[]};let a={...y};async function b(){const t=await g.getJSON("wallet_state");t&&(a={...y,...t})}async function l(){await g.setJSON("wallet_state",a)}chrome.runtime.onMessage.addListener((t,e,r)=>(A(t,e.origin??"").then(r).catch(n=>r({error:n.message})),!0));async function A(t,e){switch(t.type){case"eth_requestAccounts":return E(e);case"eth_accounts":return L(e);case"eth_chainId":return a.chainId;case"eth_sendTransaction":return D(t.data);case"personal_sign":return R(t.data);case"eth_signTypedData_v4":return U(t.data);case"wallet_switchEthereumChain":return O(t.data);case"wallet_addEthereumChain":return j(t.data);case"jeju_crossChainTransfer":return N(t.data);case"jeju_submitIntent":return V(t.data);case"connect":return T(e);case"disconnect":return C(e);default:throw new Error(`Unknown message type: ${t.type}`)}}async function E(t){if(a.isLocked)throw await w("unlock"),new Error("Wallet is locked");return a.connectedSites.includes(t)?a.accounts:(await w("connect",{origin:t}),new Promise((e,r)=>{const n=s=>{s.type==="connection_response"&&s.origin===t&&(chrome.runtime.onMessage.removeListener(n),s.approved?(a.connectedSites.push(t),l(),e(a.accounts)):r(new Error("User rejected connection")))};chrome.runtime.onMessage.addListener(n)}))}async function L(t){return a.isLocked||!a.connectedSites.includes(t)?[]:a.accounts}async function T(t){return a.connectedSites.includes(t)||(a.connectedSites.push(t),await l()),!0}async function C(t){return a.connectedSites=a.connectedSites.filter(e=>e!==t),await l(),!0}async function D(t){const e=await u("transaction",{tx:t});if(!e.approved)throw new Error("User rejected transaction");return e.hash}async function R(t){const e=await u("sign",{type:"personal_sign",message:t.message,address:t.address});if(!e.approved)throw new Error("User rejected signature");return e.signature}async function U(t){const e=await u("sign",{type:"eth_signTypedData_v4",data:t.data,address:t.address});if(!e.approved)throw new Error("User rejected signature");return e.signature}async function O(t){return a.chainId=t.chainId,await l(),B({type:"chainChanged",chainId:t.chainId}),null}async function j(t){if(!(await u("add_chain",t)).approved)throw new Error("User rejected adding chain");return null}async function N(t){const e=await u("cross_chain",t);if(!e.approved)throw new Error("User rejected cross-chain transfer");return e.requestId}async function V(t){const e=await u("intent",t);if(!e.approved)throw new Error("User rejected intent");return e.intentId}async function w(t,e){const r=new URL(chrome.runtime.getURL("popup.html"));r.hash=`/${t}`,e&&r.searchParams.set("data",JSON.stringify(e)),await chrome.windows.create({url:r.toString(),type:"popup",width:420,height:680,focused:!0})}async function u(t,e){const r=crypto.randomUUID(),n=new URL(chrome.runtime.getURL("popup.html"));return n.hash=`/${t}`,n.searchParams.set("requestId",r),n.searchParams.set("data",JSON.stringify(e)),await chrome.windows.create({url:n.toString(),type:"popup",width:420,height:680,focused:!0}),new Promise(s=>{const h=f=>{f.type==="popup_response"&&f.requestId===r&&(chrome.runtime.onMessage.removeListener(h),s(f))};chrome.runtime.onMessage.addListener(h)})}function B(t){chrome.tabs.query({},e=>{for(const r of e)r.id&&chrome.tabs.sendMessage(r.id,t).catch(()=>{})})}b();chrome.alarms.create("keepAlive",{periodInMinutes:.5});chrome.alarms.onAlarm.addListener(()=>{});console.log("Network Wallet background script initialized");
